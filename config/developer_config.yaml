version: 1

defaults:
  reasoning_effort: high
  prompt_flags:
    allow_tools: true
    allow_read: true
    allow_write: false
    allow_file_suggestions: false
  behaviors:
    timeout_policy: default
    apply_files: false
    can_finish: false

general_prompts:
  role_header: "Rolle: {role_name}\n"
  goal_section: "Ziel:\n{goal}\n"
  input_section: "\nInput (reduziertes JSON, klein halten):\n{input}\n"
  rules_header: "\nREGELN:\n"
  analysis_rules: |
    - Tiefe Analyse NUR im Feld analysis_md (Markdown String im JSON).
    - Ausgabe JSON klein halten (analysis_md darf lang sein, wird ausgelagert).
  json_contract: |
    FORMAT-VERTRAG (streng):
    - Antworte mit GENAU EINEM gültigen JSON-Objekt.
    - KEIN Text außerhalb des JSON. KEIN Markdown-Codefence.
    - Wenn unklar: gib JSON mit Feld "error" zurück.

schema_hints:
  requirements_engineer: |
    SCHEMA-HINWEIS (requirements_engineer, PSEUDO):
    summary: <string>
    needs_user_input: <bool>
    questions:
      - id: <string>
        question: <string>
        category: "critical"|"optional"
        default_suggestion: <string|null>
    requirements:
      - id: <string>
        description: <string>
        resolved: <bool>
        value: <string|null>
    analysis_md: <markdown>
    analysis_md_path: <string>
    next_owner: planner
  planner: |
    SCHEMA-HINWEIS (planner, PSEUDO):
    summary: <string>
    wave_compact_md: <markdown|null>      # optionale planner-kuratierte Wahrheit
    wave_detailed_md: <markdown|null>     # optionale planner-begruendung

    # User-Interaktion (nur bei kritischen offenen Fragen)
    needs_user_input: <bool>
    questions:
      - id: <string>
        question: <string>
        category: "critical"|"optional"
        default_suggestion: <string|null>
        priority: "low"|"normal"|"high"
        expected_answer_format: <string>

    # Delegierungen (planner-gated)
    delegations:
      - delegation_id: <string>
        agent_id: <string>
        task_description: <string>
        acceptance_criteria: [<string>]
        required_inputs: [<string>]
        provided_inputs: [<string>]
        priority: <int>
        depends_on: [<delegation_id>]
        context: <object>
        parallel_group: <string|null>

    planner_decision:
      io_status: "OK"|"NOT_OK"
      not_ok_reasons: [<string>]
      conflicts_resolved: [<string>]
      next_actions: [<string>]

    # Flow Control
    action: "delegate"|"ask_user"|"done"
    status: "CONTINUE"|"DONE"
    notes: <string|null>
  worker_agent: |
    SCHEMA-HINWEIS ({role_name}, PSEUDO):
    status: "completed"|"blocked"|"failed"
    compact_md: <markdown>
    detailed_md: <markdown>
    blocking_questions:
      - question_id: <string|null>   # optional, orchestrator erzeugt hash falls null
        question: <string>
        source: <string>
        priority: "low"|"normal"|"high"
        expected_answer_format: <string>
    optional_questions:
      - question_id: <string|null>
        question: <string>
        source: <string>
        priority: "low"|"normal"|"high"
        expected_answer_format: <string>
    missing_info_requests: [<string>]
    assumptions_made: [<string>]
    coverage:
      criteria_met: [<string>]
      criteria_unmet: [<string>]
    side_effect_log: [<object>]
    {files_block}
    error: <string|null>  # bei status failed
  default: |
    SCHEMA-HINWEIS ({role_name}, PSEUDO):
    summary: <string>
    notes: <string|null>
    next_owner_suggestion: planner

roles:
  - name: requirements_engineer
    role_file: roles/requirements_engineer.yaml
    depends_on: []
  - name: planner
    role_file: roles/planner.yaml
    depends_on: [requirements_engineer]
  - name: architect
    role_file: roles/architect.yaml
    schema_hint_template: worker_agent
    schema_hint_params:
      files_block: ""
    depends_on: [planner]
  - name: implementer
    role_file: roles/implementer.yaml
    schema_hint_template: worker_agent
    schema_hint_params:
      files_block: |
        files:
          - path: <string>
            content: <string>
    depends_on: [architect]
  - name: integrator
    role_file: roles/integrator.yaml
    schema_hint_template: worker_agent
    schema_hint_params:
      files_block: ""
    depends_on: [implementer]
